{
  "name": "LinkedIn Article Generator - AGENTS FIXED",
  "nodes": [
    {
      "parameters": {},
      "id": "trigger-manual",
      "name": "üöÄ D√©clencheur Manuel",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "507bd4507b644b78b44d4ceeb809f1e0",
          "mode": "id"
        },
        "filterType": "manual",
        "conditions": {
          "conditions": [
            {
              "key": "Trait√©",
              "condition": "isNotChecked"
            }
          ]
        },
        "limit": 1,
        "options": {}
      },
      "id": "notion-get-ideas",
      "name": "üì• R√©cup√©rer Id√©e Non Trait√©e",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "title",
              "name": "title",
              "value": "={{ $json.properties?.['Titre/Id√©e principale']?.title?.[0]?.plain_text || 'Sans titre' }}",
              "type": "string"
            },
            {
              "id": "sources",
              "name": "sources",
              "value": "={{ $json.properties?.['Sources/URLs']?.rich_text?.[0]?.plain_text || '' }}",
              "type": "string"
            },
            {
              "id": "notes",
              "name": "notes",
              "value": "={{ $json.properties?.['Notes personnelles']?.rich_text?.[0]?.plain_text || '' }}",
              "type": "string"
            },
            {
              "id": "angle",
              "name": "angle",
              "value": "={{ $json.properties?.['Angle personnel']?.rich_text?.[0]?.plain_text || '' }}",
              "type": "string"
            },
            {
              "id": "questions",
              "name": "questions",
              "value": "={{ $json.properties?.['Questions √† adresser']?.rich_text?.[0]?.plain_text || '' }}",
              "type": "string"
            },
            {
              "id": "ideaId",
              "name": "ideaId",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-idea-data",
      "name": "üìä Extraire donn√©es id√©e",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Effectue une recherche approfondie sur le sujet suivant pour un article LinkedIn professionnel:\n\nTitre: {{ $json.title }}\n\nContexte: {{ $json.sources }}\n\nNotes: {{ $json.notes }}\n\nRecherche les derni√®res actualit√©s, statistiques, √©tudes de cas et innovations sur ce sujet. Fournis au moins 5 statistiques concr√®tes et v√©rifiables, des exemples r√©cents, et les tendances actuelles.\n\nFormat de r√©ponse attendu:\n- Statistiques cl√©s (avec sources)\n- Tendances actuelles\n- Exemples concrets\n- Innovations r√©centes",
        "options": {
          "systemMessage": "Tu es un expert en recherche d'informations. Fournis des informations actuelles, des statistiques pr√©cises avec leurs sources, et des exemples concrets dat√©s de 2024-2025."
        }
      },
      "id": "perplexity-agent",
      "name": "üîç Agent Perplexity - Recherche",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [850, 300]
    },
    {
      "parameters": {
        "model": "perplexity/sonar-pro",
        "options": {}
      },
      "id": "perplexity-model",
      "name": "Perplexity Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [850, 500]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "research",
              "name": "research",
              "value": "={{ $json.output || 'Pas de recherche effectu√©e' }}",
              "type": "string"
            },
            {
              "id": "title",
              "name": "title",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.title }}",
              "type": "string"
            },
            {
              "id": "notes",
              "name": "notes",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.notes }}",
              "type": "string"
            },
            {
              "id": "angle",
              "name": "angle",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.angle }}",
              "type": "string"
            },
            {
              "id": "questions",
              "name": "questions",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.questions }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "capture-research",
      "name": "üíæ Capturer recherche",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=R√©dige un article LinkedIn professionnel de haute qualit√© bas√© sur les informations suivantes:\n\n**SUJET:** {{ $json.title }}\n\n**NOTES PERSONNELLES:** {{ $json.notes }}\n\n**ANGLE √âDITORIAL:** {{ $json.angle }}\n\n**QUESTIONS √Ä COUVRIR:** {{ $json.questions }}\n\n**RECHERCHE EFFECTU√âE:**\n{{ $json.research }}\n\n**CONSIGNES STRICTES:**\n1. Longueur: 800-1200 mots MINIMUM\n2. Structure obligatoire:\n   - Accroche percutante (question, statistique choc, ou anecdote)\n   - Introduction qui pose le contexte (100-150 mots)\n   - 3-4 sections avec sous-titres clairs\n   - Exemples concrets et chiffr√©s dans chaque section\n   - Conclusion avec appel √† l'action clair\n3. Ton: Professionnel mais conversationnel, utilise le \"vous\" ou \"nous\"\n4. Inclure au moins 3 statistiques de la recherche\n5. Terminer par une question engageante pour les lecteurs\n\n**IMPORTANT:** G√©n√®re un article COMPLET et D√âTAILL√â, pas un r√©sum√©. L'article doit √™tre pr√™t √† publier sur LinkedIn.\n\nR√©ponds UNIQUEMENT avec le texte de l'article, sans commentaires ni explications.",
        "options": {
          "systemMessage": "Tu es un expert en r√©daction d'articles LinkedIn professionnels avec 10 ans d'exp√©rience. Tu r√©diges des articles engageants, informatifs et orient√©s valeur pour les professionnels. Tes articles g√©n√®rent toujours beaucoup d'engagement car ils apportent de vraies insights pratiques et actionnables. Tu utilises un ton professionnel mais accessible, avec des exemples concrets et des donn√©es pr√©cises."
        }
      },
      "id": "claude-agent",
      "name": "‚úçÔ∏è Agent Claude - R√©daction",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "model": "claude-3-5-sonnet-20241022",
        "options": {
          "temperature": 0.7,
          "maxTokens": 2000
        }
      },
      "id": "claude-model",
      "name": "Claude Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [1250, 500]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "article",
              "name": "article",
              "value": "={{ $json.output || 'Article non g√©n√©r√©' }}",
              "type": "string"
            },
            {
              "id": "title",
              "name": "title",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.title }}",
              "type": "string"
            },
            {
              "id": "research",
              "name": "research",
              "value": "={{ $('üíæ Capturer recherche').item.json.research }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "capture-article",
      "name": "üíæ Capturer article",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=G√©n√®re exactement 10 hashtags LinkedIn pertinents et populaires pour cet article. Les hashtags doivent √™tre:\n- En fran√ßais et/ou anglais selon la pertinence\n- Un mix de hashtags g√©n√©riques (#Leadership) et sp√©cifiques au sujet\n- Sans num√©rotation ni symboles suppl√©mentaires\n- Optimis√©s pour la visibilit√© sur LinkedIn\n\nArticle:\n{{ $json.article }}\n\nR√©ponds UNIQUEMENT avec les 10 hashtags s√©par√©s par des espaces, rien d'autre.\n\nExemple de format attendu:\n#Innovation #TransformationDigitale #IA #Leadership #Tech #Futur #Management #Strat√©gie #Business #LinkedIn",
        "options": {
          "systemMessage": "Tu es un expert en marketing LinkedIn et en optimisation de hashtags. Tu connais parfaitement les hashtags tendances et ceux qui g√©n√®rent le plus d'engagement sur LinkedIn en 2025."
        }
      },
      "id": "gpt-agent",
      "name": "üè∑Ô∏è Agent GPT - Hashtags",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list"
        },
        "options": {
          "temperature": 0.5
        }
      },
      "id": "openai-model",
      "name": "OpenAI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [1650, 500]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "title",
              "name": "title",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.title }}",
              "type": "string"
            },
            {
              "id": "articleContent",
              "name": "articleContent",
              "value": "={{ $('üíæ Capturer article').item.json.article }}",
              "type": "string"
            },
            {
              "id": "hashtags",
              "name": "hashtags",
              "value": "={{ $json.output || '#LinkedIn #Article' }}",
              "type": "string"
            },
            {
              "id": "ideaId",
              "name": "ideaId",
              "value": "={{ $('üìä Extraire donn√©es id√©e').item.json.ideaId }}",
              "type": "string"
            },
            {
              "id": "postComplet",
              "name": "postComplet",
              "value": "={{ $('üíæ Capturer article').item.json.article + '\\n\\n' + ($json.output || '#LinkedIn #Article') }}",
              "type": "string"
            },
            {
              "id": "statistics",
              "name": "statistics",
              "value": "={{ $('üíæ Capturer recherche').item.json.research.match(/\\d+[%\\s]?[^\\s]*|\\d+\\s*(millions?|milliards?|thousands?|billions?)/gi)?.slice(0, 5)?.join(', ') || 'Voir article pour les donn√©es' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "prepare-final-data",
      "name": "üìã Pr√©parer donn√©es finales",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/pages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"parent\": {\n    \"database_id\": \"9b915f4f6bae479f9326ff2cfdabadd3\"\n  },\n  \"properties\": {\n    \"Titre\": {\n      \"title\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.title }}\"\n          }\n        }\n      ]\n    },\n    \"Contenu article\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ ($json.articleContent).substring(0, 2000) }}\"\n          }\n        }\n      ]\n    },\n    \"Hashtags\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.hashtags }}\"\n          }\n        }\n      ]\n    },\n    \"Post LinkedIn complet\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ ($json.postComplet).substring(0, 2000) }}\"\n          }\n        }\n      ]\n    },\n    \"Public cible\": {\n      \"select\": {\n        \"name\": \"Professionnels et d√©cideurs\"\n      }\n    },\n    \"Statistiques cl√©s\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.statistics }}\"\n          }\n        }\n      ]\n    }\n  },\n  \"children\": [\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_1\",\n      \"heading_1\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.title }}\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"divider\",\n      \"divider\": {}\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_2\",\n      \"heading_2\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"üìù Article complet\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"paragraph\",\n      \"paragraph\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.articleContent }}\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"divider\",\n      \"divider\": {}\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_2\",\n      \"heading_2\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"üè∑Ô∏è Hashtags optimis√©s\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"paragraph\",\n      \"paragraph\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.hashtags }}\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"divider\",\n      \"divider\": {}\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_2\",\n      \"heading_2\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"üìä Donn√©es cl√©s utilis√©es\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"paragraph\",\n      \"paragraph\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.statistics }}\"\n            }\n          }\n        ]\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "id": "http-notion-create",
      "name": "üíæ Cr√©er Article dans Notion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2050, 300]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "={{ `https://api.notion.com/v1/pages/${$('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.id}` }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"properties\": {\n    \"Trait√©\": {\n      \"checkbox\": true\n    }\n  }\n}",
        "options": {}
      },
      "id": "http-notion-update",
      "name": "‚úÖ Marquer Id√©e Trait√©e",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2250, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "success",
              "value": "=‚ú® Article g√©n√©r√© avec succ√®s!\n\nüìù Titre: {{ $('üìã Pr√©parer donn√©es finales').item.json.title }}\nüìä Longueur: {{ $('üìã Pr√©parer donn√©es finales').item.json.articleContent.length }} caract√®res\nüè∑Ô∏è Hashtags: {{ $('üìã Pr√©parer donn√©es finales').item.json.hashtags }}\n‚úÖ Id√©e marqu√©e comme trait√©e\nüîó URL: {{ $('üíæ Cr√©er Article dans Notion').item.json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "success-message",
      "name": "‚ú® Message de succ√®s",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [2450, 300]
    }
  ],
  "connections": {
    "üöÄ D√©clencheur Manuel": {
      "main": [[{"node": "üì• R√©cup√©rer Id√©e Non Trait√©e", "type": "main", "index": 0}]]
    },
    "üì• R√©cup√©rer Id√©e Non Trait√©e": {
      "main": [[{"node": "üìä Extraire donn√©es id√©e", "type": "main", "index": 0}]]
    },
    "üìä Extraire donn√©es id√©e": {
      "main": [[{"node": "üîç Agent Perplexity - Recherche", "type": "main", "index": 0}]]
    },
    "üîç Agent Perplexity - Recherche": {
      "main": [[{"node": "üíæ Capturer recherche", "type": "main", "index": 0}]]
    },
    "üíæ Capturer recherche": {
      "main": [[{"node": "‚úçÔ∏è Agent Claude - R√©daction", "type": "main", "index": 0}]]
    },
    "‚úçÔ∏è Agent Claude - R√©daction": {
      "main": [[{"node": "üíæ Capturer article", "type": "main", "index": 0}]]
    },
    "üíæ Capturer article": {
      "main": [[{"node": "üè∑Ô∏è Agent GPT - Hashtags", "type": "main", "index": 0}]]
    },
    "üè∑Ô∏è Agent GPT - Hashtags": {
      "main": [[{"node": "üìã Pr√©parer donn√©es finales", "type": "main", "index": 0}]]
    },
    "üìã Pr√©parer donn√©es finales": {
      "main": [[{"node": "üíæ Cr√©er Article dans Notion", "type": "main", "index": 0}]]
    },
    "üíæ Cr√©er Article dans Notion": {
      "main": [[{"node": "‚úÖ Marquer Id√©e Trait√©e", "type": "main", "index": 0}]]
    },
    "‚úÖ Marquer Id√©e Trait√©e": {
      "main": [[{"node": "‚ú® Message de succ√®s", "type": "main", "index": 0}]]
    },
    "Perplexity Model": {
      "ai_languageModel": [[{"node": "üîç Agent Perplexity - Recherche", "type": "ai_languageModel", "index": 0}]]
    },
    "Claude Model": {
      "ai_languageModel": [[{"node": "‚úçÔ∏è Agent Claude - R√©daction", "type": "ai_languageModel", "index": 0}]]
    },
    "OpenAI Model": {
      "ai_languageModel": [[{"node": "üè∑Ô∏è Agent GPT - Hashtags", "type": "ai_languageModel", "index": 0}]]
    }
  },
  "settings": {"executionOrder": "v1"}
}