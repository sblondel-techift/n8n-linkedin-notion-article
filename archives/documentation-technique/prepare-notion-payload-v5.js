// PrÃ©paration du JSON pour l'API Notion - VERSION 5
const notionPayload = {
  parent: {
    database_id: "9b915f4f6bae479f9326ff2cfdabadd3"
  },
  properties: {
    "Titre": {
      title: [
        {
          text: {
            content: $json.titre || "Sans titre"
          }
        }
      ]
    },
    "Contenu article": {
      rich_text: [
        {
          text: {
            // Version rÃ©sumÃ©e pour la propriÃ©tÃ©
            content: $json.contenuArticle || ""
          }
        }
      ]
    },
    "Hashtags": {
      rich_text: [
        {
          text: {
            content: $json.hashtags || ""
          }
        }
      ]
    },
    "Post LinkedIn complet": {
      rich_text: [
        {
          text: {
            // Version rÃ©sumÃ©e avec emoji et hashtags
            content: $json.postLinkedInComplet || ""
          }
        }
      ]
    },
    "Public cible": {
      select: {
        name: "Professionnels et dÃ©cideurs"
      }
    },
    "Statistiques clÃ©s": {
      rich_text: [
        {
          text: {
            content: $json.statistiquesCles || ""
          }
        }
      ]
    }
  },
  // Ajouter le contenu complet dans le corps de la page
  children: [
    {
      object: "block",
      type: "heading_1",
      heading_1: {
        rich_text: [
          {
            type: "text",
            text: {
              content: $json.titre || "Article LinkedIn"
            }
          }
        ]
      }
    },
    {
      object: "block",
      type: "divider",
      divider: {}
    },
    {
      object: "block",
      type: "heading_2",
      heading_2: {
        rich_text: [
          {
            type: "text",
            text: {
              content: "ðŸ“„ Article complet"
            }
          }
        ]
      }
    },
    // Diviser l'article en paragraphes pour Notion
    ...($json.contenuArticleComplet || "").split('\n\n').filter(p => p.trim()).map(paragraphe => ({
      object: "block",
      type: "paragraph",
      paragraph: {
        rich_text: [
          {
            type: "text",
            text: {
              content: paragraphe.substring(0, 2000) // Limite par bloc
            }
          }
        ]
      }
    })),
    {
      object: "block",
      type: "divider",
      divider: {}
    },
    {
      object: "block",
      type: "heading_2",
      heading_2: {
        rich_text: [
          {
            type: "text",
            text: {
              content: "ðŸš€ Post LinkedIn prÃªt Ã  publier"
            }
          }
        ]
      }
    },
    {
      object: "block",
      type: "callout",
      callout: {
        rich_text: [
          {
            type: "text",
            text: {
              content: $json.postLinkedInCompletTotal || ""
            }
          }
        ],
        icon: {
          type: "emoji",
          emoji: "ðŸ“±"
        },
        color: "blue_background"
      }
    },
    {
      object: "block",
      type: "divider",
      divider: {}
    },
    {
      object: "block",
      type: "heading_3",
      heading_3: {
        rich_text: [
          {
            type: "text",
            text: {
              content: "ðŸ“Š MÃ©tadonnÃ©es"
            }
          }
        ]
      }
    },
    {
      object: "block",
      type: "bulleted_list_item",
      bulleted_list_item: {
        rich_text: [
          {
            type: "text",
            text: {
              content: `GÃ©nÃ©rÃ© le : ${new Date($json.dateGeneration).toLocaleString('fr-FR')}`
            }
          }
        ]
      }
    },
    {
      object: "block",
      type: "bulleted_list_item",
      bulleted_list_item: {
        rich_text: [
          {
            type: "text",
            text: {
              content: `Longueur : ${$json.nombreMots || 0} mots (${$json.longueurArticle || 0} caractÃ¨res)`
            }
          }
        ]
      }
    },
    {
      object: "block",
      type: "bulleted_list_item",
      bulleted_list_item: {
        rich_text: [
          {
            type: "text",
            text: {
              content: `ID de l'idÃ©e source : ${$json.ideaId}`
            }
          }
        ]
      }
    }
  ]
};

// Retourner le payload avec toutes les autres donnÃ©es
return {
  ...($json || {}),
  notionPayload: notionPayload
};
