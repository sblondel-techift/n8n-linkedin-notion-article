{
  "name": "LinkedIn Article Generator - SOLUTION FINALE",
  "nodes": [
    {
      "parameters": {},
      "id": "trigger-manual",
      "name": "üöÄ D√©clencheur Manuel",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "507bd4507b644b78b44d4ceeb809f1e0",
          "mode": "id"
        },
        "filterType": "manual",
        "conditions": {
          "conditions": [
            {
              "key": "Trait√©",
              "condition": "isNotChecked"
            }
          ]
        },
        "limit": 1,
        "options": {}
      },
      "id": "notion-get-ideas",
      "name": "üì• R√©cup√©rer Id√©e Non Trait√©e",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Effectue une recherche approfondie sur le sujet suivant pour un article LinkedIn professionnel:\n\nTitre: {{ $json.property_titre_id_e_principale || 'Sans titre' }}\n\nContexte: {{ $json.property_sources_ur_ls || '' }}\n\nNotes: {{ $json.property_notes_personnelles || '' }}\n\nRecherche les derni√®res actualit√©s, statistiques, √©tudes de cas et innovations sur ce sujet. Fournis des donn√©es concr√®tes et v√©rifiables.",
        "options": {
          "systemMessage": "Tu es un expert en recherche d'informations. Fournis des informations actuelles, des statistiques et des exemples concrets."
        }
      },
      "id": "perplexity-agent",
      "name": "üîç Agent Perplexity - Recherche",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [650, 300]
    },
    {
      "parameters": {
        "model": "perplexity/sonar-pro",
        "options": {}
      },
      "id": "perplexity-model",
      "name": "Perplexity Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [650, 500]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=R√©dige un article LinkedIn professionnel bas√© sur les informations suivantes:\n\nSujet: {{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.property_titre_id_e_principale || 'Sans titre' }}\n\nNotes personnelles: {{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.property_notes_personnelles || '' }}\n\nAngle personnel: {{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.property_angle_personnel || '' }}\n\nQuestions √† adresser: {{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.property_questions_adresser || '' }}\n\nRecherche effectu√©e:\n{{ $json.output }}\n\nConsignes:\n- Article de 800-1200 mots\n- Structure avec accroche forte\n- D√©veloppement avec exemples concrets\n- Insights pratiques et actionnables\n- Conclusion avec appel √† l'action\n- Ton professionnel mais accessible\n\nR√©ponds UNIQUEMENT avec le texte de l'article.",
        "options": {
          "systemMessage": "Tu es un expert en r√©daction d'articles LinkedIn professionnels. Tu r√©diges des articles engageants avec une structure claire et des insights pratiques."
        }
      },
      "id": "claude-agent",
      "name": "‚úçÔ∏è Agent Claude - R√©daction",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [850, 300]
    },
    {
      "parameters": {
        "model": "claude-3-5-sonnet-20241022",
        "options": {}
      },
      "id": "claude-model",
      "name": "Claude Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [850, 500]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=G√©n√®re exactement 10 hashtags pertinents pour cet article LinkedIn:\n\n{{ $json.output }}\n\nRetourne uniquement les hashtags s√©par√©s par des espaces, sans num√©rotation ni autre texte.",
        "options": {
          "systemMessage": "Tu es un expert en marketing LinkedIn. Tu g√©n√®res des hashtags optimis√©s pour maximiser la visibilit√© des articles."
        }
      },
      "id": "gpt-agent",
      "name": "üè∑Ô∏è Agent GPT - Hashtags",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4",
          "mode": "list"
        },
        "options": {}
      },
      "id": "openai-model",
      "name": "OpenAI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [1050, 500]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "title",
              "name": "title",
              "value": "={{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.property_titre_id_e_principale || 'Sans titre' }}",
              "type": "string"
            },
            {
              "id": "articleContent",
              "name": "articleContent",
              "value": "={{ $('‚úçÔ∏è Agent Claude - R√©daction').item.json.output }}",
              "type": "string"
            },
            {
              "id": "hashtags",
              "name": "hashtags",
              "value": "={{ $json.output }}",
              "type": "string"
            },
            {
              "id": "ideaId",
              "name": "ideaId",
              "value": "={{ $('üì• R√©cup√©rer Id√©e Non Trait√©e').item.json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "prepare-final-data",
      "name": "üìã Pr√©parer donn√©es finales",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/pages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"parent\": {\n    \"database_id\": \"9b915f4f6bae479f9326ff2cfdabadd3\"\n  },\n  \"properties\": {\n    \"Titre\": {\n      \"title\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.title }}\"\n          }\n        }\n      ]\n    },\n    \"Contenu article\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.articleContent.substring(0, 2000) || 'Article g√©n√©r√©' }}\"\n          }\n        }\n      ]\n    },\n    \"Hashtags\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ $json.hashtags || '#LinkedIn' }}\"\n          }\n        }\n      ]\n    },\n    \"Post LinkedIn complet\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"{{ ($json.articleContent || '').substring(0, 1500) }}\\n\\n{{ $json.hashtags || '' }}\"\n          }\n        }\n      ]\n    },\n    \"Public cible\": {\n      \"select\": {\n        \"name\": \"Professionnels et d√©cideurs\"\n      }\n    },\n    \"Statistiques cl√©s\": {\n      \"rich_text\": [\n        {\n          \"text\": {\n            \"content\": \"Article g√©n√©r√© via n8n\"\n          }\n        }\n      ]\n    }\n  },\n  \"children\": [\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_1\",\n      \"heading_1\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.title }}\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"divider\",\n      \"divider\": {}\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"paragraph\",\n      \"paragraph\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.articleContent || 'Article en cours de g√©n√©ration' }}\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"divider\",\n      \"divider\": {}\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"heading_2\",\n      \"heading_2\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"üè∑Ô∏è Hashtags\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"object\": \"block\",\n      \"type\": \"paragraph\",\n      \"paragraph\": {\n        \"rich_text\": [\n          {\n            \"type\": \"text\",\n            \"text\": {\n              \"content\": \"{{ $json.hashtags || '#LinkedIn' }}\"\n            }\n          }\n        ]\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "id": "http-notion-create",
      "name": "üíæ Cr√©er Article dans Notion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "functionCode": "// Construire l'URL et le body pour la mise √† jour\nconst ideaId = items[0].json.ideaId;\nconst updateUrl = `https://api.notion.com/v1/pages/${ideaId}`;\n\nconsole.log('ID de la page √† mettre √† jour:', ideaId);\nconsole.log('URL construite:', updateUrl);\n\nreturn [{\n  json: {\n    url: updateUrl,\n    body: {\n      properties: {\n        \"Trait√©\": {\n          checkbox: true\n        }\n      }\n    }\n  }\n}];"
      },
      "id": "build-update-request",
      "name": "üîß Construire requ√™te de mise √† jour",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.body) }}",
        "options": {}
      },
      "id": "http-notion-update",
      "name": "‚úÖ Marquer Id√©e Trait√©e",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1850, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "success",
              "value": "=‚ú® Workflow termin√© avec succ√®s!\n\nüìù Article cr√©√©: {{ $('üíæ Cr√©er Article dans Notion').item.json.properties?.['Titre']?.title?.[0]?.plain_text }}\n‚úÖ Id√©e marqu√©e comme trait√©e\nüîó URL de l'article: {{ $('üíæ Cr√©er Article dans Notion').item.json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "success-message",
      "name": "‚ú® Message de succ√®s",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [2050, 300]
    }
  ],
  "connections": {
    "üöÄ D√©clencheur Manuel": {
      "main": [[{"node": "üì• R√©cup√©rer Id√©e Non Trait√©e", "type": "main", "index": 0}]]
    },
    "üì• R√©cup√©rer Id√©e Non Trait√©e": {
      "main": [[{"node": "üîç Agent Perplexity - Recherche", "type": "main", "index": 0}]]
    },
    "üîç Agent Perplexity - Recherche": {
      "main": [[{"node": "‚úçÔ∏è Agent Claude - R√©daction", "type": "main", "index": 0}]]
    },
    "‚úçÔ∏è Agent Claude - R√©daction": {
      "main": [[{"node": "üè∑Ô∏è Agent GPT - Hashtags", "type": "main", "index": 0}]]
    },
    "üè∑Ô∏è Agent GPT - Hashtags": {
      "main": [[{"node": "üìã Pr√©parer donn√©es finales", "type": "main", "index": 0}]]
    },
    "üìã Pr√©parer donn√©es finales": {
      "main": [[{"node": "üíæ Cr√©er Article dans Notion", "type": "main", "index": 0}]]
    },
    "üíæ Cr√©er Article dans Notion": {
      "main": [[{"node": "üîß Construire requ√™te de mise √† jour", "type": "main", "index": 0}]]
    },
    "üîß Construire requ√™te de mise √† jour": {
      "main": [[{"node": "‚úÖ Marquer Id√©e Trait√©e", "type": "main", "index": 0}]]
    },
    "‚úÖ Marquer Id√©e Trait√©e": {
      "main": [[{"node": "‚ú® Message de succ√®s", "type": "main", "index": 0}]]
    },
    "Perplexity Model": {
      "ai_languageModel": [[{"node": "üîç Agent Perplexity - Recherche", "type": "ai_languageModel", "index": 0}]]
    },
    "Claude Model": {
      "ai_languageModel": [[{"node": "‚úçÔ∏è Agent Claude - R√©daction", "type": "ai_languageModel", "index": 0}]]
    },
    "OpenAI Model": {
      "ai_languageModel": [[{"node": "üè∑Ô∏è Agent GPT - Hashtags", "type": "ai_languageModel", "index": 0}]]
    }
  },
  "settings": {"executionOrder": "v1"}
}