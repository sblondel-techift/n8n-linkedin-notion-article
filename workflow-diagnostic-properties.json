{
  "name": "Diagnostic - RÃ©cupÃ©rer PropriÃ©tÃ©s Notion",
  "nodes": [
    {
      "parameters": {},
      "id": "trigger-manual",
      "name": "ğŸš€ DÃ©clencheur Manuel",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.notion.com/v1/databases/507bd4507b644b78b44d4ceeb809f1e0",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "options": {}
      },
      "id": "get-ideas-schema",
      "name": "ğŸ“¥ SchÃ©ma Base IdÃ©es",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 200]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.notion.com/v1/databases/9b915f4f6bae479f9326ff2cfdabadd3",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Notion-Version",
              "value": "2022-06-28"
            }
          ]
        },
        "options": {}
      },
      "id": "get-articles-schema",
      "name": "ğŸ“ SchÃ©ma Base Articles",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "functionCode": "// Extraire les propriÃ©tÃ©s de la base IdÃ©es\nconst properties = items[0].json.properties;\nconst title = items[0].json.title?.[0]?.plain_text || 'Base IdÃ©es';\n\nconst formattedProperties = [];\n\nfor (const [key, value] of Object.entries(properties)) {\n  formattedProperties.push({\n    nom: key,\n    type: value.type,\n    id: value.id,\n    configuration: JSON.stringify(value[value.type] || {}, null, 2)\n  });\n}\n\nreturn [{\n  json: {\n    database_name: title,\n    database_id: items[0].json.id,\n    properties_count: formattedProperties.length,\n    properties: formattedProperties,\n    raw_properties: properties\n  }\n}];"
      },
      "id": "format-ideas-properties",
      "name": "ğŸ”§ Formater PropriÃ©tÃ©s IdÃ©es",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [650, 200]
    },
    {
      "parameters": {
        "functionCode": "// Extraire les propriÃ©tÃ©s de la base Articles\nconst properties = items[0].json.properties;\nconst title = items[0].json.title?.[0]?.plain_text || 'Base Articles LinkedIn';\n\nconst formattedProperties = [];\n\nfor (const [key, value] of Object.entries(properties)) {\n  formattedProperties.push({\n    nom: key,\n    type: value.type,\n    id: value.id,\n    configuration: JSON.stringify(value[value.type] || {}, null, 2)\n  });\n}\n\nreturn [{\n  json: {\n    database_name: title,\n    database_id: items[0].json.id,\n    properties_count: formattedProperties.length,\n    properties: formattedProperties,\n    raw_properties: properties\n  }\n}];"
      },
      "id": "format-articles-properties",
      "name": "ğŸ”§ Formater PropriÃ©tÃ©s Articles",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [650, 400]
    },
    {
      "parameters": {
        "functionCode": "// Combiner les rÃ©sultats des deux bases\nconst ideasData = $('ğŸ”§ Formater PropriÃ©tÃ©s IdÃ©es').item.json;\nconst articlesData = $('ğŸ”§ Formater PropriÃ©tÃ©s Articles').item.json;\n\nconsole.log('\\n========================================');\nconsole.log('ğŸ“Š RAPPORT COMPLET DES PROPRIÃ‰TÃ‰S NOTION');\nconsole.log('========================================\\n');\n\nconsole.log('ğŸ“¥ BASE \"IDÃ‰ES D\\'ARTICLES\"');\nconsole.log('ID:', ideasData.database_id);\nconsole.log('Nombre de propriÃ©tÃ©s:', ideasData.properties_count);\nconsole.log('\\nPropriÃ©tÃ©s:');\nconsole.log('----------------------------------------');\nideasData.properties.forEach(prop => {\n  console.log(`\\nâœ“ ${prop.nom}`);\n  console.log(`  Type: ${prop.type}`);\n  console.log(`  ID: ${prop.id}`);\n  if (prop.type === 'select' || prop.type === 'multi_select') {\n    console.log(`  Options: ${prop.configuration}`);\n  }\n});\n\nconsole.log('\\n\\nğŸ“ BASE \"ARTICLES LINKEDIN GÃ‰NÃ‰RÃ‰S\"');\nconsole.log('ID:', articlesData.database_id);\nconsole.log('Nombre de propriÃ©tÃ©s:', articlesData.properties_count);\nconsole.log('\\nPropriÃ©tÃ©s:');\nconsole.log('----------------------------------------');\narticlesData.properties.forEach(prop => {\n  console.log(`\\nâœ“ ${prop.nom}`);\n  console.log(`  Type: ${prop.type}`);\n  console.log(`  ID: ${prop.id}`);\n  if (prop.type === 'select' || prop.type === 'multi_select') {\n    console.log(`  Options: ${prop.configuration}`);\n  }\n});\n\nconsole.log('\\n========================================\\n');\n\n// CrÃ©er un rapport formatÃ©\nconst rapport = {\n  timestamp: new Date().toISOString(),\n  bases_de_donnees: {\n    idees: {\n      nom: ideasData.database_name,\n      id: ideasData.database_id,\n      nombre_proprietes: ideasData.properties_count,\n      proprietes: ideasData.properties\n    },\n    articles: {\n      nom: articlesData.database_name,\n      id: articlesData.database_id,\n      nombre_proprietes: articlesData.properties_count,\n      proprietes: articlesData.properties\n    }\n  },\n  mapping_workflow: {\n    idees_requises: [\n      'Titre/IdÃ©e principale',\n      'Sources/URLs',\n      'Notes personnelles',\n      'Angle personnel',\n      'Questions Ã  adresser',\n      'TraitÃ©'\n    ],\n    articles_requises: [\n      'Titre',\n      'Contenu article',\n      'Hashtags',\n      'Post LinkedIn complet',\n      'Public cible',\n      'Statistiques clÃ©s'\n    ]\n  }\n};\n\nreturn [{\n  json: rapport\n}];"
      },
      "id": "combine-results",
      "name": "ğŸ“Š Rapport Complet",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "message",
              "name": "message",
              "value": "=âœ… Diagnostic terminÃ©!\n\nğŸ“¥ Base IdÃ©es: {{ $json.bases_de_donnees.idees.nombre_proprietes }} propriÃ©tÃ©s trouvÃ©es\nğŸ“ Base Articles: {{ $json.bases_de_donnees.articles.nombre_proprietes }} propriÃ©tÃ©s trouvÃ©es\n\nâš ï¸ VÃ©rifiez la console pour le rapport dÃ©taillÃ©",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "success",
      "name": "âœ¨ SuccÃ¨s",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1050, 300]
    }
  ],
  "connections": {
    "ğŸš€ DÃ©clencheur Manuel": {
      "main": [[
        {"node": "ğŸ“¥ SchÃ©ma Base IdÃ©es", "type": "main", "index": 0},
        {"node": "ğŸ“ SchÃ©ma Base Articles", "type": "main", "index": 0}
      ]]
    },
    "ğŸ“¥ SchÃ©ma Base IdÃ©es": {
      "main": [[{"node": "ğŸ”§ Formater PropriÃ©tÃ©s IdÃ©es", "type": "main", "index": 0}]]
    },
    "ğŸ“ SchÃ©ma Base Articles": {
      "main": [[{"node": "ğŸ”§ Formater PropriÃ©tÃ©s Articles", "type": "main", "index": 0}]]
    },
    "ğŸ”§ Formater PropriÃ©tÃ©s IdÃ©es": {
      "main": [[{"node": "ğŸ“Š Rapport Complet", "type": "main", "index": 0}]]
    },
    "ğŸ”§ Formater PropriÃ©tÃ©s Articles": {
      "main": [[{"node": "ğŸ“Š Rapport Complet", "type": "main", "index": 0}]]
    },
    "ğŸ“Š Rapport Complet": {
      "main": [[{"node": "âœ¨ SuccÃ¨s", "type": "main", "index": 0}]]
    }
  },
  "settings": {"executionOrder": "v1"}
}